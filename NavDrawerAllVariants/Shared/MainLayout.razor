@inherits LayoutComponentBase

@inject NavigationManager NavigationManager

<div class="row-layout root-router-container">
    <IgbNavDrawer Open=true Position="NavDrawerPosition.Relative" class="nav-drawer" root_router-scope>
        <IgbNavDrawerItem Active="@IsActive(NavigationManager.BaseUri + "/no-params")" @onclick=@(() => NavigationManager.NavigateTo(NavigationManager.BaseUri + $"/no-params"))>
            <span slot="icon">
                <span class="material-icons icon">
                    account_circle
                </span>
            </span>
            <div slot="content">NO PARAMS</div>
        </IgbNavDrawerItem>
        <IgbNavDrawerItem Active="@IsActive(NavigationManager.BaseUri + "/no-params/no-params-1")" @onclick=@(() => NavigationManager.NavigateTo(NavigationManager.BaseUri + $"/no-params/no-params-1"))>
            <span slot="icon">
                <span class="material-icons icon">
                    account_circle
                </span>
            </span>
            <div slot="content">NO PARAMS 1</div>
        </IgbNavDrawerItem>
        <IgbNavDrawerItem Active="@IsActive(NavigationManager.BaseUri + "/no-params/path-params-1")" @onclick=@(() => NavigationManager.NavigateTo(NavigationManager.BaseUri + $"/no-params/path-params-1"))>
            <span slot="icon">
                <span class="material-icons icon">
                    account_circle
                </span>
            </span>
            <div slot="content">PATH PARAMS 1</div>
        </IgbNavDrawerItem>
        <IgbNavDrawerItem Active="@IsActive(NavigationManager.BaseUri + "/no-params/query-param-1")" @onclick=@(() => NavigationManager.NavigateTo(NavigationManager.BaseUri + $"/no-params/query-param-1"))>
            <span slot="icon">
                <span class="material-icons icon">
                    account_circle
                </span>
            </span>
            <div slot="content">QUERY PARAMS 1</div>
        </IgbNavDrawerItem>
        <IgbNavDrawerItem Active="@IsActive(NavigationManager.BaseUri + "/path-params")" @onclick=@(() => NavigationManager.NavigateTo(NavigationManager.BaseUri + $"/path-params?path=200"))>
            <span slot="icon">
                <span class="material-icons icon">
                    account_circle
                </span>
            </span>
            <div slot="content">PATH PARAM</div>
        </IgbNavDrawerItem>
        <IgbNavDrawerItem Active="@IsActive(NavigationManager.BaseUri + "/path-params/no-params-2")" @onclick=@(() => NavigationManager.NavigateTo(NavigationManager.BaseUri + $"/path-params/no-params-2?path=2001"))>
            <span slot="icon">
                <span class="material-icons icon">
                    account_circle
                </span>
            </span>
            <div slot="content">NO PARAM 2</div>
        </IgbNavDrawerItem>
        <IgbNavDrawerItem Active="@IsActive("/path-params/path-params-2")" @onclick=@(() => NavigationManager.NavigateTo($"/path-params/path-params-2?path=2002&path1=2100"))>
            <span slot="icon">
                <span class="material-icons icon">
                    account_circle
                </span>
            </span>
            <div slot="content">PATH PARAM 2</div>
        </IgbNavDrawerItem>
        <IgbNavDrawerItem Active="@IsActive("/path-params/query-params-2")" @onclick=@(() => NavigationManager.NavigateTo($"/path-params/query-params-2?path=2003&q2=2202&q1=2201"))>
            <span slot="icon">
                <span class="material-icons icon">
                    account_circle
                </span>
            </span>
            <div slot="content">QUERY PARAM 2</div>
        </IgbNavDrawerItem>
        <IgbNavDrawerItem Active="@IsActive("/query-params")" @onclick=@(() => NavigationManager.NavigateTo($"/query-params?q11=3001&q21=3002"))>
            <span slot="icon">
                <span class="material-icons icon">
                    account_circle
                </span>
            </span>
            <div slot="content">QUERY PARAM</div>
        </IgbNavDrawerItem>
        <IgbNavDrawerItem Active="@IsActive("/query-params/no-params-3")" @onclick=@(() => NavigationManager.NavigateTo($"/query-params/no-params-3?q11=4001&q21=4002"))>
            <span slot="icon">
                <span class="material-icons icon">
                    account_circle
                </span>
            </span>
            <div slot="content">NO PARAM 3</div>
        </IgbNavDrawerItem>
        <IgbNavDrawerItem Active="@IsActive("/query-params/path-params-3/5100")" @onclick=@(() => NavigationManager.NavigateTo($"/query-params/path-params-3/5100?q11=5001&q21=5002"))>
            <span slot="icon">
                <span class="material-icons icon">
                    account_circle
                </span>
            </span>
            <div slot="content">PATH PARAM 3</div>
        </IgbNavDrawerItem>
        <IgbNavDrawerItem Active="@IsActive("/query-params/query-params-3")" @onclick=@(() => NavigationManager.NavigateTo($"/query-params/query-params-3?q11=6001&q21=6002&q22=6302&q12=6301"))>
            <span slot="icon">
                <span class="material-icons icon">
                    account_circle
                </span>
            </span>
            <div slot="content">QUERY PARAM 3</div>
        </IgbNavDrawerItem>
        <IgbNavDrawerItem>
            <span slot="icon">
                <span class="material-icons icon">
                    account_circle
                </span>
            </span>
            <div slot="content">No navigation</div>
        </IgbNavDrawerItem>
    </IgbNavDrawer>
    <div class="view-container">
        @Body
    </div>
</div>

@code {

    public bool IsActive(string targetPath)
    {
        if (string.IsNullOrWhiteSpace(targetPath))
            return false;

        var baseUri = new Uri(NavigationManager.BaseUri);
        var currentUri = new Uri(NavigationManager.Uri);
        var targetUri = new Uri(baseUri, targetPath);

        // Normalize paths (strip trailing slashes)
        var currentPath = currentUri.AbsolutePath.TrimEnd('/');
        var targetPathNormalized = targetUri.AbsolutePath.TrimEnd('/');

        // Use Uri.Compare for comparison
        var comparison = Uri.Compare(currentUri, targetUri, UriComponents.Path, UriFormat.Unescaped, StringComparison.OrdinalIgnoreCase);

        // Exact match
        if (comparison == 0)
            return true;

        return false;
    }
}
